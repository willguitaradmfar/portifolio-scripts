"use strict";var o=this&&this.__awaiter||function(o,t,i,n){return new(i||(i=Promise))((function(e,c){function a(o){try{d(n.next(o))}catch(o){c(o)}}function s(o){try{d(n.throw(o))}catch(o){c(o)}}function d(o){var t;o.done?e(o.value):(t=o.value,t instanceof i?t:new i((function(o){o(t)}))).then(a,s)}d((n=n.apply(o,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.main=void 0;const t={main:function({input:t,utils:i}){var n,e;return o(this,void 0,void 0,(function*(){(null===(n=null==t?void 0:t.input)||void 0===n?void 0:n.json)||i.throw("ERROR_NO_JSON","No json input",400);const o=JSON.parse(null===(e=null==t?void 0:t.input)||void 0===e?void 0:e.json),c=[];for(const t of o.itens)for(const o of t.posicoes)o.tipoProduto=t.tipoProduto,c.push(o);let a=0;for(const o of c){const t=o.codigoNegociacao||o.codigoIsin,n=yield i.coll("position").findOne({codigoNegociacao:t});n?yield i.coll("position").updateOne({_id:n._id},{$set:Object.assign(Object.assign({},o),{codigoNegociacao:t,updated_at:new Date})}):yield i.coll("position").create(Object.assign(Object.assign({},o),{codigoNegociacao:t,updated_at:new Date})),a+=o.valorAtualizado}return{total:a}}))}};exports.main=t.main.bind(t);